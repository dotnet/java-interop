<Project>

  <Target Name="BuildNativeAOTFromJNIJar"
      BeforeTargets="Build"
      Inputs="@(HelloNativeAOTFromJNIJar)"
      Outputs="$(OutputPath)hello-from-java.jar">
    <MakeDir Directories="$(IntermediateOutputPath)h-classes" />
    <ItemGroup>
      <_Source Include="@(HelloNativeAOTFromJNIJar->Replace('%5c', '/'))" />
    </ItemGroup>
    <WriteLinesToFile
        File="$(IntermediateOutputPath)_java_sources.txt"
        Lines="@(_Source)"
        Overwrite="True"
    />
    <ItemGroup>
      <_JavacOpt Include="$(_JavacSourceOptions)" />
      <_JavacOpt Include="-d &quot;$(IntermediateOutputPath)h-classes&quot; " />
      <_JavacOpt Include="-classpath &quot;$(OutputPath)java-interop.jar&quot; " />
      <_JavacOpt Include="&quot;@$(IntermediateOutputPath)_java_sources.txt&quot;" />
      <_JavacOpt Include="-h &quot;$(IntermediateOutputPath)h-classes&quot; " />
    </ItemGroup>
    <Exec Command="&quot;$(JavaCPath)&quot; @(_JavacOpt, ' ')" />
    <Delete Files="$(IntermediateOutputPath)_java_sources.txt" />
    <Exec Command="&quot;$(JarPath)&quot; cf &quot;$(OutputPath)hello-from-java.jar&quot; -C &quot;$(IntermediateOutputPath)h-classes&quot; ." />
  </Target>

  <Target Name="_NativeLibRequiresLibPrefix"
      AfterTargets="Publish">
    <Copy
        Condition=" '$(OS)' != 'Windows_NT' "
        SourceFiles="$(PublishDir)$(AssemblyName).dylib"
        DestinationFiles="$(PublishDir)lib$(AssemblyName).dylib"
    />
    <Copy SourceFiles="$(OutputPath)hello-from-java.jar" DestinationFolder="$(PublishDir)" />
  </Target>

  <Target Name="RunJavaSample">
    <ItemGroup>
      <_Classpath Include="hello-from-java.jar" />
      <_Classpath Include="java-interop.jar" />
    </ItemGroup>
    <PropertyGroup>
      <_CPSep Condition=" '$(OS)' == 'Windows_NT' ">;</_CPSep>
      <_CPSep Condition=" '$(_CPSep)' == '' ">:</_CPSep>
      <_CP>@(_Classpath, '$(_CPSep)')</_CP>
    </PropertyGroup>
    <Exec
        Command="&quot;$(JavaPath)&quot; -classpath &quot;$(_CP)&quot; com/microsoft/hello_from_jni/App"
        WorkingDirectory="$(PublishDir)"
    />
  </Target>
</Project>
